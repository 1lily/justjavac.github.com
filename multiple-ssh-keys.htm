<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Multiple SSH keys</title>
<link rel="stylesheet" href="css/style.css" type="text/css" rev="stylesheet">
</head>
<body>
<div id="page">
    <article class="post">
    <header class="post_hd">
    <h1>多个github帐号的SSH key切换</h1>
    </header>
    <div class="content">
        <p>github使用SSH与客户端连接。如果是单用户（first），生成密钥对后，将公钥保存至github，每次连接时SSH客户端发送本地私钥（默认~/.ssh/id_rsa）到服务端验证。单用户情况下，连接的服务器上保存的公钥和发送的私钥自然是配对的。但是如果是多用户（first，second），我们在连接到second的帐号时，second保存的是自己的公钥，但是SSH客户端依然发送默认私钥，即first的私钥，那么这个验证自然无法通过。不过，要实现多帐号下的SSH key切换在客户端做一些配置即可。</p>
        <p>首先cd到~/.ssh 使用 ssh-keygen -t -rsa -C ‘second@mail.com’ 生成新的SSH key：id_rsa_second，生成完后将新的SSH public key添加到github。</p>
<pre>ssh-keygen -t -rsa -C 'second@mail.com'</pre>
        <p>默认SSH只会读取id_rsa，所以为了让SSH识别新的私钥，需要将其添加到SSH agent</p>
<pre>ssh-add ～/.ssh/id_rsa_second</pre>
        <p>该命令如果报错：Could not open a connection to your authentication agent.无法连接到ssh agent，可执行ssh-agent bash命令后再执行ssh-add命令。</p>
        <p>完成以上步骤后在~/.ssh目录创建config文件，该文件用于配置私钥对应的服务器。内容如下：</p>
<pre># Default github user(first@mail.com)
Host github.com
 HostName github.com
 User git
 IdentityFile C:/Users/username/.ssh/id_rsa

# second user(second@mail.com)
Host github-second
 HostName github.com
 User git
 IdentityFile C:/Users/username/.ssh/id_rsa_second</pre>
        <p><span id="more-2269"></span>配置完成后，在连接非默认帐号的github仓库时，远程库的地址要对应地做一些修改，比如现在添加second帐号下的一个仓库test，则需要这样添加：</p>
<pre>git remote add test git@github-second:second/test.git #并非原来的git@github.com:second/test.git</pre>
        <p>这样每次连接都会使用id_rsa_second与服务器进行连接。至此，大功告成！</p>
        <p><strong>注意：</strong>github根据配置文件的user.email来获取github帐号显示author信息，所以对于多帐号用户一定要记得将user.email改为相应的email(second@mail.com)。</p>
        <p>参考github帮助文档：</p>
        <ul>
            <li><a href="http://help.github.com/win-set-up-git/">http://help.github.com/win-set-up-git/</a></li>
            <li><a href="http://help.github.com/multiple-ssh-keys/">http://help.github.com/multiple-ssh-keys/</a></li>
        </ul>
    </div>
    </article>

</div>

</body>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11003279-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</html>